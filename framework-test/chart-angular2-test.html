<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Web Components -->
    <script src="../../webcomponentsjs/webcomponents.min.js"></script>
    <script>
        window.Polymer = {
            dom: 'shadow'
        };
    </script>
    <link rel="import" href="../vaadin-pie-chart.html">
    <!-- browser tester -->
    <script src="../../web-component-tester/browser.js"></script>

    <!-- Polyfill(s) for older browsers -->
    <script src="../node_modules/core-js/client/shim.min.js"></script>

    <script src="../node_modules/zone.js/dist/zone.js"></script>
    <script src="../node_modules/reflect-metadata/Reflect.js"></script>
    <script src="../node_modules/systemjs/dist/system.src.js"></script>

    <script src="systemjs.config.js"></script>
    <script>
        document.addEventListener('WebComponentsReady', function() {
            System.import('app').catch(function(err) {
                console.error(err);
            });
        });
    </script>
</head>

<body>
    <my-app>Loading...</my-app>
</body>

<script>
    suite('framework integration', function() {

        // Bootstrapping Angular 2 in Edge takes more than 10 seconds
        this.timeout(30000);

        test('verify angular 2 binding works', function(done) {
            var myApp = document.querySelector("my-app");
            myApp.addEventListener('chartsReady', function() {
                setTimeout(function() {
                    var elementChart = document.querySelector("vaadin-pie-chart");
                    expect(elementChart.chart.redraw).to.exist;
                    var chart = elementChart.chart;
                    expect(chart.series).to.exist;
                    expect(chart.series).not.to.be.empty;
                    expect(chart.series[0].data).to.exist;
                    expect(chart.series[0].data).not.to.be.empty;
                    expect(chart.series[0].data).to.have.length(6);
                    var chartSlices = Polymer.dom(elementChart.root).querySelectorAll(".highcharts-series path");
                    expect(chartSlices).to.have.length(6);
                    done();
                }, 1);
            });
        });
        test('Verify chart has full size', function(done) {
            setTimeout(function() {
                var elementChart = document.querySelector("vaadin-pie-chart");
                var highchartsContainer = elementChart.$$(".highcharts-container");
                expect(highchartsContainer).to.exist;
                expect(highchartsContainer.offsetWidth).to.equal(document.body.clientWidth);
                done();
            }, 100);
        });
    });
</script>

</html>
