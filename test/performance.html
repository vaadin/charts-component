<!doctype html>

<head>
  <meta charset="UTF-8">
  <title>vaadin-chart tests</title>
  <script src="../../web-component-tester/browser.js"></script>
  <script src="../../webcomponentsjs/webcomponents-lite.js"></script>
  <link rel="import" href="../../test-fixture/test-fixture.html">
  <link rel="import" href="../vaadin-chart.html">
</head>

<body>
  <test-fixture id="performance-demo">
    <template>
      <vaadin-chart></vaadin-chart>
    </template>
  </test-fixture>

  <script>
    describe('Performance', () => {
      let chart, redrawSpy;

      before((done) => {
        chart = fixture('performance-demo');

        Polymer.RenderStatus.afterNextRender(chart, () => {
          redrawSpy = sinon.spy(chart.configuration, 'redraw');
          done();
        });
      });

      it('should redraw the chart only 1 time when using update', (done) => {
        chart.update({
          title: 'Title',
          xAxis: {
            categories: ['2021', '2022', '2023', '2024']
          },
          yAxis: {
            title: 'Values'
          },
          credits: {
            enabled: true,
            title: 'Vaadin'
          },
          series: [
            {
              name: 'Series 1',
              data: [0, 100, 200, 300]
            },
            {
              name: 'Series 2',
              data: [0, 100, 200, 300]
            }
          ]
        });

        Polymer.RenderStatus.beforeNextRender(chart, () => {
          expect(redrawSpy.calledOnce).to.be.true;
          done();
        });
      });
    });
  </script>
</body>
